---
import PageLayout from '../layouts/PageLayout.astro';
import { translations, type Language } from '../scripts/translations';

// Server-side rendered page - detects language from URL param or cookie
export const prerender = false;

const url = Astro.url;
const langParam = url.searchParams.get('lang');

// Redirect ?lang=cs to clean URL (Czech is default - keeps URLs clean)
if (langParam === 'cs') {
  const cleanUrl = new URL(Astro.url);
  cleanUrl.searchParams.delete('lang');
  const redirectPath = cleanUrl.pathname + (cleanUrl.search || '') + (cleanUrl.hash || '');
  return Astro.redirect(redirectPath || '/', 301);
}

const cookieLang = Astro.cookies.get('preferredLanguage')?.value;
const lang: Language = (langParam === 'en' || langParam === 'cs') ? langParam : 
                       (cookieLang === 'en' || cookieLang === 'cs') ? cookieLang : 'cs';
const t = translations[lang];

// Set cookie if language was explicitly selected via URL param
if (langParam && (langParam === 'en' || langParam === 'cs')) {
  Astro.cookies.set('preferredLanguage', langParam, { 
    path: '/', 
    maxAge: 60 * 60 * 24 * 365, // 1 year
    sameSite: 'lax'
  });
}
---

<PageLayout 
  title={t.rec_title}
  description={t.rec_meta_description}
  lang={lang}
  showDigitalRain={false}
  simpleNav={false}
  simpleFooter={false}
>
  <main class="max-w-4xl mx-auto px-4 sm:px-6 py-20">
    <header class="mb-16">
      <h1 class="text-4xl md:text-5xl font-bold mb-6 tracking-tight text-white">{t.rec_headline}</h1>
      <p class="text-neutral-400 text-lg leading-relaxed">
        {t.rec_intro}
      </p>
    </header>

    <div class="prose prose-invert max-w-none space-y-16 text-neutral-300 leading-relaxed">
      
      <section>
        <h2 class="text-2xl font-bold text-white mb-6 border-l-4 border-primary pl-4">{t.rec_section_1_title}</h2>
        <p class="mb-4">
          {t.rec_section_1_text_1}
        </p>
        <p>
          {t.rec_section_1_text_2}
        </p>
      </section>

      <section class="bg-white/[0.03] border border-white/5 rounded-2xl p-8">
        <h3 class="text-xl font-bold text-white mb-6">{t.rec_example_title}</h3>
        <div class="space-y-6 text-sm bg-black/40 p-6 rounded-xl border border-white/5 font-mono leading-relaxed">
          <p><span class="text-primary font-bold">{t.rec_example_purpose}</span> <strong class="text-white">{t.rec_example_purpose_text}</strong></p>
          <p><span class="text-primary font-bold">{t.rec_example_ai}</span> {t.rec_example_ai_text}</p>
          <p><span class="text-primary font-bold">{t.rec_example_scope}</span> {t.rec_example_scope_text}</p>
          <p><span class="text-primary font-bold">{t.rec_example_duration}</span> <strong class="text-white">{t.rec_example_duration_text}</strong></p>
        </div>
      </section>

      <section>
        <h2 class="text-2xl font-bold text-white mb-6 border-l-4 border-primary pl-4">{t.rec_section_2_title}</h2>
        <p class="mb-6">
          {t.rec_section_2_text}
        </p>
        <div class="bg-white/[0.02] p-8 rounded-xl border border-white/5">
          <p class="mb-4 font-bold text-white">{t.rec_storage_title}</p>
          <p class="mb-4">{t.rec_storage_text}</p>
          <ul class="grid md:grid-cols-2 gap-4">
            <li class="flex items-start gap-2 bg-white/[0.03] p-3 rounded-lg border border-white/5">
              <span class="text-primary mt-1">✓</span> {t.rec_storage_item_1}
            </li>
            <li class="flex items-start gap-2 bg-white/[0.03] p-3 rounded-lg border border-white/5">
              <span class="text-primary mt-1">✓</span> {t.rec_storage_item_2}
            </li>
            <li class="flex items-start gap-2 bg-white/[0.03] p-3 rounded-lg border border-white/5">
              <span class="text-primary mt-1">✓</span> {t.rec_storage_item_3}
            </li>
            <li class="flex items-start gap-2 bg-white/[0.03] p-3 rounded-lg border border-white/5">
              <span class="text-primary mt-1">✓</span> {t.rec_storage_item_4}
            </li>
          </ul>
        </div>
      </section>

      <section class="bg-primary/5 border border-primary/20 rounded-2xl p-8">
        <h2 class="text-2xl font-bold text-white mb-4">{t.rec_ai_act_title}</h2>
        <p>
          {t.rec_ai_act_text}
        </p>
      </section>

    </div>
  </main>
</PageLayout>
