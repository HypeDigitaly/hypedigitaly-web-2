---
import PageLayout from '../../layouts/PageLayout.astro';
import BlogCard from '../../components/blog/BlogCard.astro';
import { translations, type Language } from '../../scripts/translations';
import blogData from '../../data/blog-posts.json';
import type { BlogPost } from '../../types/blog';
import { blogCategories } from '../../types/blog';

const lang: Language = 'cs';
const t = translations[lang];

// Get all posts - filtering will be done client-side
const allPosts = blogData.posts as BlogPost[];

// Get featured post (first featured or first post)
const featuredPost = allPosts.find(post => post.featured) || allPosts[0];
const regularPosts = allPosts.filter(post => post !== featuredPost);
---

<PageLayout 
  title={t.blog_title}
  description={t.blog_desc}
  lang={lang}
>
  <!-- ==================== HERO SECTION ==================== -->
  <section class="relative max-w-7xl mx-auto px-6 pt-12 pb-16">
    <div class="text-center max-w-4xl mx-auto">
      <!-- Badge -->
      <div class="animate-on-scroll [animation:animationIn_0.8s_ease-out_0.1s_both] inline-flex items-center gap-2 px-4 py-2 rounded-full bg-primary/10 border border-primary/20 mb-8">
        <iconify-icon icon="solar:document-text-bold" class="text-primary text-lg"></iconify-icon>
        <span class="text-sm font-medium text-primary">{t.blog_all_posts}</span>
      </div>
      
      <!-- Headline -->
      <h1 class="animate-on-scroll [animation:animationIn_0.8s_ease-out_0.2s_both] leading-[0.95] md:text-6xl lg:text-7xl text-4xl font-medium text-white tracking-tighter mb-8">
        <span>{t.blog_headline_1}</span>
        <br class="hidden md:block">
        <span class="text-neutral-600 transition-colors hover:text-primary duration-500">{t.blog_headline_2}</span>
      </h1>
      
      <!-- Description -->
      <p class="animate-on-scroll [animation:animationIn_0.8s_ease-out_0.3s_both] text-lg md:text-xl text-neutral-400 font-light max-w-2xl mx-auto leading-relaxed">
        {t.blog_desc}
      </p>
    </div>
  </section>

  <!-- ==================== BLOG CONTENT ==================== -->
  <section class="bg-[#050505] border-t border-white/5 py-16">
    <div class="max-w-7xl mx-auto px-6">
      <!-- Section Header -->
      <div class="flex flex-col md:flex-row justify-between items-start md:items-end mb-8 text-[10px] md:text-xs font-mono text-neutral-500 uppercase tracking-[0.2em] gap-4">
        <div class="flex items-center gap-2">
          <span class="text-white">01</span>
          <span class="w-12 h-px bg-white/10"></span>
        </div>
        <div class="text-white/40">// ČLÁNKY</div>
        <div class="hidden md:block text-right">BLOG</div>
      </div>

      <!-- Category Filter - Client-side -->
      <div class="animate-on-scroll [animation:animationIn_0.8s_ease-out_0.4s_both]">
        <div id="blog-filters" class="flex flex-wrap items-center gap-3 mb-12">
          <!-- All Category -->
          <button 
            data-filter="all"
            class="filter-btn active px-4 py-2 rounded-full text-sm font-medium transition-all duration-300 bg-white text-neutral-900"
          >
            {t.blog_category_all}
          </button>
          
          <!-- Dynamic Categories -->
          {blogCategories.map((category) => {
            const name = lang === 'cs' ? category.name_cs : category.name_en;
            return (
              <button 
                data-filter={category.id}
                class={`filter-btn px-4 py-2 rounded-full text-sm font-medium flex items-center gap-2 transition-all duration-300 border ${
                  category.id === 'success-story' 
                    ? 'bg-primary/10 text-primary border-primary/30 hover:bg-primary/20' 
                    : 'bg-orange-500/10 text-orange-400 border-orange-500/30 hover:bg-orange-500/20'
                }`}
              >
                <iconify-icon icon={category.icon} class="text-base"></iconify-icon>
                {name}
              </button>
            );
          })}
        </div>
      </div>

      <!-- Blog Posts Container -->
      <div id="blog-posts-container">
        <!-- Featured Post -->
        {featuredPost && (
          <div class="blog-post animate-on-scroll [animation:animationIn_0.8s_ease-out_0.5s_both] mb-12" data-category={featuredPost.category}>
            <BlogCard post={featuredPost} lang={lang} featured={true} />
          </div>
        )}

        <!-- Regular Posts Grid -->
        {regularPosts.length > 0 && (
          <div id="regular-posts-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {regularPosts.map((post, index) => (
              <div class={`blog-post animate-on-scroll [animation:animationIn_0.8s_ease-out_${0.6 + index * 0.1}s_both]`} data-category={post.category}>
                <BlogCard post={post} lang={lang} />
              </div>
            ))}
          </div>
        )}
      </div>

      <!-- No Posts Message (hidden by default) -->
      <div id="no-posts-message" class="text-center py-16 hidden">
        <iconify-icon icon="solar:document-text-linear" class="text-6xl text-neutral-700 mb-4"></iconify-icon>
        <p class="text-neutral-500 text-lg">{t.blog_no_posts}</p>
      </div>
    </div>
  </section>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const filterButtons = document.querySelectorAll('.filter-btn');
      const blogPosts = document.querySelectorAll('.blog-post');
      const noPostsMessage = document.getElementById('no-posts-message');
      const postsContainer = document.getElementById('blog-posts-container');

      // Check URL params on load
      const urlParams = new URLSearchParams(window.location.search);
      const initialCategory = urlParams.get('category') || 'all';
      
      // Apply initial filter
      applyFilter(initialCategory);

      filterButtons.forEach(btn => {
        btn.addEventListener('click', () => {
          const filter = btn.getAttribute('data-filter');
          applyFilter(filter);
          
          // Update URL without reload
          const url = new URL(window.location.href);
          if (filter === 'all') {
            url.searchParams.delete('category');
          } else {
            url.searchParams.set('category', filter);
          }
          window.history.pushState({}, '', url);
        });
      });

      function applyFilter(filter: string | null) {
        let visibleCount = 0;

        // Update button styles
        filterButtons.forEach(btn => {
          const btnFilter = btn.getAttribute('data-filter');
          const isActive = btnFilter === filter;
          
          btn.classList.remove('active', 'bg-white', 'text-neutral-900', 'bg-primary', 'bg-orange-500');
          
          if (isActive) {
            btn.classList.add('active');
            if (btnFilter === 'all') {
              btn.classList.add('bg-white', 'text-neutral-900');
            } else if (btnFilter === 'success-story') {
              btn.classList.add('bg-primary', 'text-white');
              btn.classList.remove('bg-primary/10', 'text-primary');
            } else if (btnFilter === 'tutorial') {
              btn.classList.add('bg-orange-500', 'text-white');
              btn.classList.remove('bg-orange-500/10', 'text-orange-400');
            }
          } else {
            if (btnFilter === 'all') {
              btn.classList.add('bg-white/5', 'text-neutral-400');
              btn.classList.remove('bg-white', 'text-neutral-900');
            } else if (btnFilter === 'success-story') {
              btn.classList.add('bg-primary/10', 'text-primary');
              btn.classList.remove('bg-primary', 'text-white');
            } else if (btnFilter === 'tutorial') {
              btn.classList.add('bg-orange-500/10', 'text-orange-400');
              btn.classList.remove('bg-orange-500', 'text-white');
            }
          }
        });

        // Filter posts
        blogPosts.forEach(post => {
          const postCategory = post.getAttribute('data-category');
          const shouldShow = filter === 'all' || postCategory === filter;
          
          if (shouldShow) {
            post.classList.remove('hidden');
            visibleCount++;
          } else {
            post.classList.add('hidden');
          }
        });

        // Show/hide no posts message
        if (visibleCount === 0) {
          noPostsMessage?.classList.remove('hidden');
          postsContainer?.classList.add('hidden');
        } else {
          noPostsMessage?.classList.add('hidden');
          postsContainer?.classList.remove('hidden');
        }
      }
    });
  </script>

</PageLayout>

