---
import PageLayout from '../layouts/PageLayout.astro';
import TechStackSection from '../components/sections/TechStackSection.astro';
import WorkMethodsGrid from '../components/sections/WorkMethodsGrid.astro';
import ServicesOverviewGrid from '../components/sections/ServicesOverviewGrid.astro';
import ProcessSection from '../components/sections/ProcessSection.astro';
import ProblemSection from '../components/sections/ProblemSection.astro';
import DeliverablesGrid from '../components/sections/DeliverablesGrid.astro';
import AdminPanelUnifiedSection from '../components/sections/AdminPanelUnifiedSection.astro';
import { translations, type Language, getLocalizedHref } from '../scripts/translations';

// Server-side rendered page - detects language from URL param or cookie
export const prerender = false;

const url = Astro.url;
const langParam = url.searchParams.get('lang');

// Redirect ?lang=cs to clean URL (Czech is default - keeps URLs clean)
if (langParam === 'cs') {
  const cleanUrl = new URL(Astro.url);
  cleanUrl.searchParams.delete('lang');
  const redirectPath = cleanUrl.pathname + (cleanUrl.search || '') + (cleanUrl.hash || '');
  return Astro.redirect(redirectPath || '/', 301);
}

const cookieLang = Astro.cookies.get('preferredLanguage')?.value;
const lang: Language = (langParam === 'en' || langParam === 'cs') ? langParam : 
                       (cookieLang === 'en' || cookieLang === 'cs') ? cookieLang : 'cs';
const t = translations[lang];

// Set cookie if language was explicitly selected via URL param
if (langParam && (langParam === 'en' || langParam === 'cs')) {
  Astro.cookies.set('preferredLanguage', langParam, { 
    path: '/', 
    maxAge: 60 * 60 * 24 * 365, // 1 year
    sameSite: 'lax'
  });
}

// Helper function for language-aware hrefs
const href = (path: string) => getLocalizedHref(path, lang);

// SEO: Constants
const SITE_URL = 'https://hypedigitaly.ai';

// SEO: Page meta (localized)
const pageTitle = t.services_hub_meta_title;
const pageDescription = t.services_hub_meta_desc;

// SEO: ItemList Structured Data for services
const servicesListSchema = {
  "@context": "https://schema.org",
  "@type": "ItemList",
  "name": lang === 'cs' ? "AI služby HypeDigitaly" : "HypeDigitaly AI Services",
  "itemListElement": [
    { "@type": "ListItem", "position": 1, "name": t.service_chatbot_title, "url": `${SITE_URL}/chatbot` },
    { "@type": "ListItem", "position": 2, "name": t.service_voicebot_title, "url": `${SITE_URL}/voicebot` },
    { "@type": "ListItem", "position": 3, "name": t.service_agent_title, "url": `${SITE_URL}/ai-agent` },
    { "@type": "ListItem", "position": 4, "name": t.service_automation_title, "url": `${SITE_URL}/automatizace` },
    { "@type": "ListItem", "position": 5, "name": t.dataprep_nav_title, "url": `${SITE_URL}/priprava-dat` },
    { "@type": "ListItem", "position": 6, "name": t.service_dev_title, "url": `${SITE_URL}/vyvoj-aplikaci` },
    { "@type": "ListItem", "position": 7, "name": t.service_web_title, "url": `${SITE_URL}/web-design` },
    { "@type": "ListItem", "position": 8, "name": t.service_consult_title, "url": `${SITE_URL}/konzultace` },
  ]
};

// SEO: BreadcrumbList
const breadcrumbSchema = {
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    { "@type": "ListItem", "position": 1, "name": lang === 'cs' ? "Domů" : "Home", "item": SITE_URL },
    { "@type": "ListItem", "position": 2, "name": lang === 'cs' ? "Služby" : "Services", "item": `${SITE_URL}/sluzby` }
  ]
};
---

<PageLayout 
  title={pageTitle}
  description={pageDescription}
  lang={lang}
>
  <script slot="head" type="application/ld+json" set:html={JSON.stringify(servicesListSchema)} />
  <script slot="head" type="application/ld+json" set:html={JSON.stringify(breadcrumbSchema)} />

  <!-- ==================== SECTION 01: HERO WITH SERVICES CARDS ==================== -->
  <section class="relative pt-28 pb-12">
    <!-- Background decorative elements (complementary to DigitalRain) -->
    <div class="absolute inset-0 pointer-events-none overflow-hidden">
      <div class="absolute top-10 left-1/4 w-[500px] h-[500px] bg-primary/8 rounded-full blur-[100px]"></div>
      <div class="absolute top-1/3 right-1/4 w-[400px] h-[400px] bg-purple-500/6 rounded-full blur-[80px]"></div>
      <div class="absolute bottom-0 left-1/2 -translate-x-1/2 w-[600px] h-[300px] bg-blue-500/5 rounded-full blur-[100px]"></div>
    </div>

    <div class="relative max-w-7xl mx-auto px-4 sm:px-6">
      <!-- Breadcrumb -->
      <nav class="mb-6 text-sm text-neutral-500" aria-label="Breadcrumb">
        <ol class="flex items-center gap-2">
          <li><a href={href("/")} class="hover:text-primary transition-colors">{lang === 'cs' ? 'Domů' : 'Home'}</a></li>
          <li><span class="text-neutral-600">/</span></li>
          <li class="text-neutral-400">{lang === 'cs' ? 'Služby' : 'Services'}</li>
        </ol>
      </nav>

      <!-- Section Number Header -->
      <div class="flex flex-col md:flex-row justify-between items-start md:items-end mb-10 text-[10px] md:text-xs font-mono text-neutral-400 uppercase tracking-[0.2em] gap-4">
        <div class="flex items-center gap-2">
          <span class="text-white">01</span>
          <span class="w-12 h-px bg-white/10"></span>
        </div>
        <div class="text-white/40">{t.services_hub_badge}</div>
        <div class="hidden md:block text-right">{lang === 'cs' ? 'NAŠE SLUŽBY' : 'OUR SERVICES'}</div>
      </div>

      <!-- Hero Header - Compact -->
      <div class="text-center max-w-4xl mx-auto mb-10">
        <div class="animate-on-scroll [animation:animationIn_0.8s_ease-out_0.1s_both] inline-flex items-center gap-2 px-4 py-2 rounded-full bg-white/5 border border-white/10 mb-6">
          <span class="text-xs font-mono text-primary tracking-wider">{t.services_hub_badge}</span>
        </div>
        
        <h1 class="animate-on-scroll [animation:animationIn_0.8s_ease-out_0.15s_both] text-4xl md:text-5xl lg:text-6xl font-medium text-white tracking-tight mb-4">
          {t.services_hub_title}
          <span class="block text-neutral-500">{t.services_hub_title_2}</span>
        </h1>
        
        <p class="animate-on-scroll [animation:animationIn_0.8s_ease-out_0.2s_both] text-base md:text-lg text-neutral-400 max-w-2xl mx-auto mb-8">
          {t.services_hub_subtitle}
        </p>
      </div>

      <!-- Services Cards Grid (without deliverables and CTA - they come later) -->
      <div class="animate-on-scroll [animation:animationIn_0.8s_ease-out_0.25s_both] relative max-w-6xl mx-auto">
        <ServicesOverviewGrid lang={lang} showCta={false} showDeliverables={false} />
      </div>

      <!-- CTA Button after Services Cards -->
      <div class="mt-12 text-center">
        <a href="#kontakt" class="animate-on-scroll [animation:animationIn_0.8s_ease-out_0.5s_both] shiny-cta group inline-flex max-w-md mx-auto">
          <span class="btn-content">
            <span class="text-lg font-semibold tracking-tight">{t.services_hub_cta}</span>
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5 text-white/80 group-hover:translate-x-1 transition-transform">
              <path d="M5 12h14"></path>
              <path d="m12 5 7 7-7 7"></path>
            </svg>
          </span>
        </a>
      </div>
    </div>
  </section>

  <!-- ==================== SECTION 02: PROCESS (JAK PROBÍHÁ SPOLUPRÁCE) ==================== -->
  <ProcessSection lang={lang} sectionNumber="02" />

  <!-- ==================== SECTION 03: PROBLEM (Z JAKÉHO DŮVODU ORGANIZACE S AI NEUSPĚJÍ) ==================== -->
  <ProblemSection lang={lang} sectionNumber="03" />

  <!-- ==================== SECTION 04: DELIVERABLES (CO OD NÁS ZÍSKÁTE) + CTA ==================== -->
  <DeliverablesGrid lang={lang} sectionNumber="04" showHeader={true} showCta={true} />

  <!-- ==================== SECTION 05: HOW WE WORK ==================== -->
  <section class="bg-[#050505] border-t border-white/5 py-20">
    <div class="max-w-7xl mx-auto px-4 sm:px-6">
      <!-- Section Number Header -->
      <div class="flex flex-col md:flex-row justify-between items-start md:items-end mb-12 text-[10px] md:text-xs font-mono text-neutral-400 uppercase tracking-[0.2em] gap-4">
        <div class="flex items-center gap-2">
          <span class="text-white">05</span>
          <span class="w-12 h-px bg-white/10"></span>
        </div>
        <div class="text-white/40">{t.how_we_work_tag}</div>
        <div class="hidden md:block text-right">{t.how_we_work_label}</div>
      </div>

      <div class="text-center mb-12">
        <h2 class="text-3xl md:text-4xl font-medium text-white tracking-tight">
          {t.how_we_work_headline_1} <span class="text-neutral-500">{t.how_we_work_headline_2}</span>
        </h2>
        <p class="mt-4 text-base text-neutral-400 font-light max-w-xl mx-auto">
          {t.how_we_work_subheadline}
        </p>
      </div>
      <WorkMethodsGrid lang={lang} />
    </div>
  </section>

  <!-- ==================== SECTION 06: TECH STACK ==================== -->
  <TechStackSection lang={lang} />

  <!-- ==================== SECTION 07: RAGus.ai UNIFIED SECTION ==================== -->
  <AdminPanelUnifiedSection lang={lang} sectionNumber="07" id="ragus" />

  <!-- ==================== SECTION 08: VOICEFLOW CERTIFIED EXPERT ==================== -->
  <section class="bg-[#050505] border-t border-white/5 py-16">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 text-center">
      <div class="animate-on-scroll [animation:animationIn_0.8s_ease-out_0.2s_both] inline-flex flex-col md:flex-row items-center gap-6 md:gap-10 p-8 rounded-2xl bg-gradient-to-br from-white/5 to-white/[0.02] border border-white/10 backdrop-blur-sm">
        <!-- Voiceflow Badge -->
        <div class="flex-shrink-0">
          <img src="/assets/images/voiceflow-badge.png" alt="Voiceflow Certified Expert" class="w-24 h-24 md:w-28 md:h-28 object-contain">
        </div>
        
        <!-- Text Content -->
        <div class="text-left">
          <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-primary/10 border border-primary/20 mb-3">
            <iconify-icon icon="solar:verified-check-bold" class="text-primary"></iconify-icon>
            <span class="text-xs font-semibold text-primary uppercase tracking-wider">{t.vf_badge}</span>
          </div>
          <h3 class="text-xl md:text-2xl font-bold text-white mb-2">{t.vf_headline}</h3>
          <p class="text-neutral-400 text-sm md:text-base mb-4 max-w-md">
            {t.vf_desc}
          </p>
          <a href="https://partners.voiceflow.com/tfl9ptojz0xf" target="_blank" rel="noopener noreferrer" class="vf-button" style="--vf-bg: #00A39A; --vf-hover-bg: #00C4B4; --vf-glow-rgb: 0, 196, 180;">
            <div class="vf-points-wrapper">
              <i class="vf-point"></i><i class="vf-point"></i><i class="vf-point"></i><i class="vf-point"></i><i class="vf-point"></i>
              <i class="vf-point"></i><i class="vf-point"></i><i class="vf-point"></i><i class="vf-point"></i><i class="vf-point"></i>
            </div>
            <span class="vf-inner">
              <span>{t.vf_cta}</span>
              <svg class="vf-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5">
                <path d="M5 12h14"></path>
                <path d="m12 5 7 7-7 7"></path>
              </svg>
            </span>
          </a>
        </div>
      </div>
    </div>
  </section>

</PageLayout>
