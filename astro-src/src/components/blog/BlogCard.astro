---
import { translations, type Language } from '../../scripts/translations';
import type { BlogPost, BlogCategoryInfo } from '../../types/blog';
import { blogCategories } from '../../types/blog';

export interface Props {
  post: BlogPost;
  lang?: Language;
  featured?: boolean;
}

const { post, lang = 'cs', featured = false } = Astro.props;
const t = translations[lang];

const title = lang === 'cs' ? post.title_cs : post.title_en;
const excerpt = lang === 'cs' ? post.excerpt_cs : post.excerpt_en;
const tags = lang === 'cs' ? post.tags_cs : post.tags_en;

const category = blogCategories.find(c => c.id === post.category) as BlogCategoryInfo;
const categoryName = lang === 'cs' ? category.name_cs : category.name_en;

// Format date
const publishedDate = new Date(post.published_date);
const formattedDate = publishedDate.toLocaleDateString(lang === 'cs' ? 'cs-CZ' : 'en-US', {
  year: 'numeric',
  month: 'long',
  day: 'numeric'
});

// Color classes based on category
const categoryColors = {
  'success-story': {
    bg: 'bg-primary/10',
    text: 'text-primary',
    border: 'border-primary/30',
    hoverBorder: 'hover:border-primary/50'
  },
  'tutorial': {
    bg: 'bg-orange-500/10',
    text: 'text-orange-400',
    border: 'border-orange-500/30',
    hoverBorder: 'hover:border-orange-500/50'
  }
};

const colors = categoryColors[post.category];
---

{featured ? (
  <!-- Featured Card - Solid Category Border Style -->
  <div class="featured-card-wrapper max-w-xl">
    <a href={`/blog/${post.slug}`} class={`group block relative rounded-3xl p-[3px] transition-all duration-300 ${
      post.category === 'success-story' 
        ? 'bg-primary hover:shadow-lg hover:shadow-primary/20' 
        : 'bg-orange-500 hover:shadow-lg hover:shadow-orange-500/20'
    }`}>
      <div class="bg-[#0A0A0A] rounded-[21px] overflow-hidden">
        <!-- Featured Image - no white border/outline -->
        {post.featured_image && (
          <div class="aspect-[16/9] overflow-hidden bg-[#0d0d0d]">
            <img 
              src={post.featured_image} 
              alt={title} 
              class="w-full h-full object-cover group-hover:scale-[1.02] transition-transform duration-500"
            />
          </div>
        )}
        
        <div class="p-6 pt-2">
          <!-- Meta Row -->
          <div class="flex flex-wrap items-center gap-3 mb-3 text-sm">
            <span class="text-neutral-400">{formattedDate}</span>
            <span class={`w-1.5 h-1.5 rounded-full ${post.category === 'success-story' ? 'bg-primary' : 'bg-orange-500'}`}></span>
            <span class={`${colors.text} font-medium`}>{categoryName}</span>
          </div>
          
          <!-- Title -->
          <h2 class={`text-xl md:text-2xl font-bold text-white mb-3 transition-colors leading-tight ${
            post.category === 'success-story' ? 'group-hover:text-primary' : 'group-hover:text-orange-400'
          }`}>
            {title}
          </h2>
          
          <!-- Excerpt -->
          <p class="text-neutral-400 mb-6 line-clamp-4 text-sm leading-relaxed">
            {excerpt}
          </p>
          
          <!-- CTA Button with Bubble Effect -->
          <span class={`blog-card-btn inline-flex items-center gap-2 px-6 py-3 rounded-xl text-white font-semibold transition-all relative overflow-hidden ${
            post.category === 'success-story' ? 'blog-btn-primary' : 'blog-btn-orange'
          }`}>
            <span class="blog-btn-bubbles">
              <span class="blog-btn-bubble"></span>
              <span class="blog-btn-bubble"></span>
              <span class="blog-btn-bubble"></span>
              <span class="blog-btn-bubble"></span>
              <span class="blog-btn-bubble"></span>
              <span class="blog-btn-bubble"></span>
            </span>
            <span class="relative z-10">{t.blog_read_more}</span>
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="relative z-10 group-hover:translate-x-1 transition-transform" aria-hidden="true">
              <path d="M5 12h14"></path>
              <path d="m12 5 7 7-7 7"></path>
            </svg>
          </span>
        </div>
      </div>
    </a>
  </div>
) : (
  <!-- Regular Card - Solid Category Border -->
  <div class={`rounded-2xl p-[2px] transition-all duration-300 ${
    post.category === 'success-story' 
      ? 'bg-primary hover:shadow-lg hover:shadow-primary/20' 
      : 'bg-orange-500 hover:shadow-lg hover:shadow-orange-500/20'
  }`}>
    <a href={`/blog/${post.slug}`} class="group block bg-[#0A0A0A] rounded-[14px] overflow-hidden">
      <!-- Featured Image - no white border/outline -->
      {post.featured_image && (
        <div class="aspect-[16/9] overflow-hidden bg-[#0d0d0d]">
          <img 
            src={post.featured_image} 
            alt={title} 
            class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"
          />
        </div>
      )}
      
      <div class="p-5 pt-2">
        <!-- Meta Row -->
        <div class="flex flex-wrap items-center gap-2 mb-3 text-xs">
          <span class="text-neutral-400">{formattedDate}</span>
          <span class={`w-1 h-1 rounded-full ${post.category === 'success-story' ? 'bg-primary' : 'bg-orange-500'}`}></span>
          <span class={`${colors.text} font-medium`}>{categoryName}</span>
        </div>
        
        <!-- Title -->
        <h3 class={`text-lg font-bold text-white mb-3 transition-colors line-clamp-2 ${
          post.category === 'success-story' ? 'group-hover:text-primary' : 'group-hover:text-orange-400'
        }`}>
          {title}
        </h3>
        
        <!-- Excerpt -->
        <p class="text-sm text-neutral-400 mb-4 line-clamp-3">
          {excerpt}
        </p>
        
        <!-- CTA Button with Bubble Effect -->
        <span class={`blog-card-btn inline-flex items-center gap-2 px-5 py-2.5 rounded-xl text-white text-sm font-semibold transition-all relative overflow-hidden ${
          post.category === 'success-story' ? 'blog-btn-primary' : 'blog-btn-orange'
        }`}>
          <span class="blog-btn-bubbles">
            <span class="blog-btn-bubble"></span>
            <span class="blog-btn-bubble"></span>
            <span class="blog-btn-bubble"></span>
            <span class="blog-btn-bubble"></span>
            <span class="blog-btn-bubble"></span>
            <span class="blog-btn-bubble"></span>
          </span>
          <span class="relative z-10">{t.blog_read_more}</span>
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="relative z-10 group-hover:translate-x-1 transition-transform" aria-hidden="true">
            <path d="M5 12h14"></path>
            <path d="m12 5 7 7-7 7"></path>
          </svg>
        </span>
      </div>
    </a>
  </div>
)}

